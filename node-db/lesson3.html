
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Week 13 - Promises and Mongo Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="lesson4.html" />
    
    
    <link rel="prev" href="lesson2.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../lesson0.html">
            
                <a href="../lesson0.html">
            
                    
                    Week 0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    HTML/CSS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../html-css/lesson1.html">
            
                <a href="../html-css/lesson1.html">
            
                    
                    Week 1 - Semantic HTML and CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../html-css/lesson2.html">
            
                <a href="../html-css/lesson2.html">
            
                    
                    Week 2 - Responsive Web and layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../html-css/lesson3.html">
            
                <a href="../html-css/lesson3.html">
            
                    
                    Week 3 - Frameworks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../html-css/coding-101.html">
            
                <a href="../html-css/coding-101.html">
            
                    
                    Coding 101
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    JavaScript Core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../js-core/lesson1.html">
            
                <a href="../js-core/lesson1.html">
            
                    
                    Week 4 - Hello JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../js-core/lesson2.html">
            
                <a href="../js-core/lesson2.html">
            
                    
                    Week 5 - Arrays and Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../js-core/lesson3.html">
            
                <a href="../js-core/lesson3.html">
            
                    
                    Week 6 - Unit Testing and TDD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../js-core/lesson3.5.html">
            
                <a href="../js-core/lesson3.5.html">
            
                    
                    Week 6.5 - Pair Programming Day
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    JavaScript Core II
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../js-core-2/lesson4.html">
            
                <a href="../js-core-2/lesson4.html">
            
                    
                    Week 7 - JS in the Browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../js-core-2/lesson5.html">
            
                <a href="../js-core-2/lesson5.html">
            
                    
                    Week 8 - Good design and OO
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../js-core-2/lesson6.html">
            
                <a href="../js-core-2/lesson6.html">
            
                    
                    Week 9 - More Arrays and ES6
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../js-core-2/lesson7.html">
            
                <a href="../js-core-2/lesson7.html">
            
                    
                    Week 10 - More Objects and core JS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Node and DB
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="lesson1.html">
            
                <a href="lesson1.html">
            
                    
                    Week 11 - Node and Express 101
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="lesson2.html">
            
                <a href="lesson2.html">
            
                    
                    Week 12 - Templating and APIs 
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.3" data-path="lesson3.html">
            
                <a href="lesson3.html">
            
                    
                    Week 13 - Promises and Mongo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="lesson4.html">
            
                <a href="lesson4.html">
            
                    
                    Week 14
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="lesson5.md">
            
                <span>
            
                    
                    Week 15
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    React
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../react/lesson1.html">
            
                <a href="../react/lesson1.html">
            
                    
                    Week 16
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../react/lesson2.html">
            
                <a href="../react/lesson2.html">
            
                    
                    Week 17
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../react/lesson3.html">
            
                <a href="../react/lesson3.html">
            
                    
                    Week 18
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../react/lesson4.html">
            
                <a href="../react/lesson4.html">
            
                    
                    Week 19
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../house-rules.html">
            
                <a href="../house-rules.html">
            
                    
                    House Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../PRACTICES.html">
            
                <a href="../PRACTICES.html">
            
                    
                    Coding Standards and Best Practices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../CONTRIBUTING.html">
            
                <a href="../CONTRIBUTING.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../lesson-template.html">
            
                <a href="../lesson-template.html">
            
                    
                    Lesson Template
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Week 13 - Promises and Mongo</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p><img src="https://img.shields.io/badge/status-draft-darkred.svg" alt=""> </p>
<h1 id="node-3">Node 3</h1>
<p><strong>What we will learn today?</strong></p>
<ul>
<li>Recap</li>
<li>Middleware</li>
<li>Express.Router</li>
<li>Promises</li>
<li>MVC</li>
<li>Mongo</li>
</ul>
<hr>
<h1 id="middleware">Middleware</h1>
<p>Middleware functions are functions that have access to the request object, <code>req</code>, the response object, <code>res</code>, and the next middleware function in the application&#x2019;s request-response cycle. The next middleware function is commonly denoted by a variable named <code>next</code>.</p>
<p>Middleware functions can perform the following tasks:</p>
<ul>
<li>Execute any code</li>
<li>Make changes to the request and the response objects</li>
<li>End the request-response cycle</li>
<li>Call the next middleware function in the stack</li>
</ul>
<blockquote>
<p><strong>Exercise</strong>: We&apos;ve already used one built-in middleware in our app - what was it?</p>
</blockquote>
<h2 id="handle-page-not-found">Handle Page Not found</h2>
<blockquote>
<p>Try to navigate to a url that doesn&apos;t exist. What do you get? Open the <strong>Developer tools</strong> and check what status code do you get back.</p>
</blockquote>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;404&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="setup-an-error-handler">Setup an error handler</h2>
<p>You define error-handling middleware in the same way as other middleware, except with four arguments instead of three; specifically with the signature (err, req, res, next):</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Something broke!&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="lets-write-a-custom-middleware">Let&apos;s write a custom middleware</h3>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> myLogger <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;LOGGED&apos;</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>myLogger<span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p><strong>Exercise</strong>: Follow the tutorial for writing <code>requestTime</code> at <a href="https://expressjs.com/en/guide/writing-middleware.html" target="_blank">https://expressjs.com/en/guide/writing-middleware.html</a> and add it to your own application</p>
</blockquote>
<h1 id="using-expressrouter">Using Express.Router</h1>
<p>We have lots of Routes in <strong>server.js</strong>, we can use the express.Router class to create modular, mountable route handlers. A Router instance is a complete middleware and routing system; for this reason, it is often referred to as a &#x201C;mini-app&#x201D;.
<a href="https://expressjs.com/en/guide/routing.html#express-router" target="_blank">https://expressjs.com/en/guide/routing.html#express-router</a></p>
<blockquote>
<p><strong>Exercise</strong>: Use <code>express.Router</code> to organise the routes in <strong>server.js</strong> in a more <em>modular</em> fashion. Write your new file under <code>/routes/site-routes.js</code>.</p>
</blockquote>
<h1 id="promises">Promises</h1>
<p>Callbacks are a fundamental part of JavaScript - the fact that functions are <em>first-class citizens</em> and it&apos;s possible to pass them around is very powerful and makes JavaScript different from many other programming languages. You should learn how to read, write callbacks and be comfortable around them. Though, there are other more advanced solutions for tackling the callback hell.</p>
<p><strong>Promises</strong> are a way to write async code that still appears as though it is executing in a top-down way, and handles more types of errors due to encouraged use of try/catch style error handling.</p>
<blockquote>
<p><strong>The Promise object</strong> represents the eventual completion (or failure) of an asynchronous operation, and its resulting value. <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank">MDN</a></p>
</blockquote>
<p>This example from <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank">MDN</a> helps to <strong>promisify</strong> the <code>setTimeout</code> example. </p>
<p>``js
let myFirstPromise = new Promise((resolve, reject) =&gt; {
  // We call resolve(...) when what we were doing made async successful, and reject(...) when it failed.
  // In this example, we use setTimeout(...) to simulate async code. 
  // In reality, you will probably be using something like XHR or an HTML5 API.
  setTimeout(function(){
    resolve(&quot;Success!&quot;); // Yay! Everything went well!
  }, 250);
});</p>
<p>myFirstPromise.then((successMessage) =&gt; {
  // successMessage is whatever we passed in the resolve(...) function above.
  // It doesn&apos;t have to be a string, but if it is only a succeed message, it probably will be.
  console.log(&quot;Yay! &quot; + successMessage);
});
```</p>
<blockquote>
<p><strong>Exercise</strong>: Let&apos;s rewrite the code above using <code>fetch</code> which provides an alternative to <code>XmlHttpRequest</code> that uses a Promise-based API - <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch</a></p>
</blockquote>
<h1 id="mvc">MVC</h1>
<blockquote>
<p>Model&#x2013;view&#x2013;controller (MVC) is a software architectural pattern for implementing user interfaces on computers. It divides a given application into three interconnected parts in order to separate internal representations of information from the ways that information is presented to and accepted from the user. The MVC design pattern decouples these major components allowing for efficient code reuse and parallel development. (Wikipedia)</p>
<p>Watch Wes Bos&apos; video about MVC together
<strong>Exercise</strong>: create a <strong>controllers</strong> folder, add a <strong>blogController</strong> and move the logic for your routes (currently in <strong>routes/site-routes.js</strong>) to this new file.</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="lesson2.html" class="navigation navigation-prev " aria-label="Previous page: Week 12 - Templating and APIs ">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="lesson4.html" class="navigation navigation-next " aria-label="Next page: Week 14">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Week 13 - Promises and Mongo","level":"1.6.3","depth":2,"next":{"title":"Week 14","level":"1.6.4","depth":2,"path":"node-db/lesson4.md","ref":"node-db/lesson4.md","articles":[]},"previous":{"title":"Week 12 - Templating and APIs ","level":"1.6.2","depth":2,"path":"node-db/lesson2.md","ref":"node-db/lesson2.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["prism","-highlight"],"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"node-db/lesson3.md","mtime":"2017-07-30T07:05:14.774Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-07-30T07:06:40.355Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

